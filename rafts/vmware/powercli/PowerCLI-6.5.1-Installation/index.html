<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.5.2 by Michael Rose
  Copyright 2017 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>            PowerCLI 6.5.1 Installation      vGemba      </title>




<meta name="description" content="Automate the install of PowerCLI 6.5.1">




<meta name="author" content="Colin Westwater">

<meta property="og:locale" content="en_GB">
<meta property="og:site_name" content="vGemba">
<meta property="og:title" content="PowerCLI 6.5.1 Installation">


  <link rel="canonical" href="http://localhost:4000/vmware/powercli/PowerCLI-6.5.1-Installation/">
  <meta property="og:url" content="http://localhost:4000/vmware/powercli/PowerCLI-6.5.1-Installation/">



  <meta property="og:description" content="Automate the install of PowerCLI 6.5.1">



  <meta name="twitter:site" content="@cwestwater">
  <meta name="twitter:title" content="PowerCLI 6.5.1 Installation">
  <meta name="twitter:description" content="Automate the install of PowerCLI 6.5.1">
  <meta name="twitter:url" content="http://localhost:4000/vmware/powercli/PowerCLI-6.5.1-Installation/">

  
    <meta name="twitter:card" content="summary">
    
  

  
    <meta name="twitter:creator" content="@Colin Westwater">
  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2017-04-26T00:00:00+01:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Colin Westwater",
      "url" : "http://localhost:4000",
      "sameAs" : ["https://twitter.com/cwestwater"]
    }
  </script>






<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="vGemba Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="http://localhost:4000/">vGemba</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/about/">About</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/categories/">Categories</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/year-archive/">Year Archive</a></li>
          
        </ul>
        <button><div class="navicon"></div></button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    



<div id="main" role="main">
  
  <div class="sidebar sticky">
  

<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="http://localhost:4000/assets/images/bio_photo.png" class="author__avatar" alt="Colin Westwater" itemprop="image">
      
    </div>
  

  <div class="author__content">
    <h3 class="author__name" itemprop="name">Colin Westwater</h3>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> <span itemprop="name">Paisley, Scotland</span>
        </li>
      

      

      

      

      
        <li>
          <a href="https://twitter.com/cwestwater" itemprop="sameAs">
            <i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      
        <li>
          <a href="https://plus.google.com/+ColinWestwater" itemprop="sameAs">
            <i class="fa fa-fw fa-google-plus-square" aria-hidden="true"></i> Google+
          </a>
        </li>
      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/cwestwater" itemprop="sameAs">
            <i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fa fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="PowerCLI 6.5.1 Installation">
    <meta itemprop="description" content="Automate the install of PowerCLI 6.5.1">
    <meta itemprop="datePublished" content="April 26, 2017">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">PowerCLI 6.5.1 Installation
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p>PowerCLI 6.5.1 was released on Friday and the big change in this version is that it’s deployed using the <a href="https://www.powershellgallery.com/">PowerShell Gallery</a>.</p>

<p>This is great - no more having to login the VMware portal, finding the installer, then installing.  This is a great move that will really help people install PowerCLI onto their computers.  The next great part of this version is the modules are loaded automatically when starting PowerShell!  Simply start typing a PowerCLI cmdlet and PowerShell will load the PowerCLI module automatically.</p>

<p>Kyle Ruddy <a href="https://twitter.com/kmruddy">(@kmruddy)</a> has a blog post detailing how to install it.  You can find that here: <a href="https://blogs.vmware.com/PowerCLI/2017/04/powercli-install-process-powershell-gallery.html">Welcome PowerCLI to the PowerShell Gallery – Install Process Updates</a></p>

<p>Broadly speaking the install steps are:</p>

<p>Ensure Windows Management Framework 5 or greater is installed.  You should always have the latest version installed which is at this time WMF 5.1.  You can grab it <a href="https://www.microsoft.com/en-us/download/details.aspx?id=54616">here</a>
Uninstall existing versions of PowerCLI
Install PowerCLI from the PowerShell Gallery.</p>

<p>These steps assume you already have the NuGet provider installed in PowerShell and the PowerShell Gallery is a trusted source.</p>

<p>There seems to be a few manual steps to perform, so lets script it.  The script is kinda ugly but heck it works.  I could spend more time to refine it honestly I don’t think it’s worth the effort - it works! The script does the following:</p>

<ol>
  <li>Checks WMF v5 or greater is installed</li>
  <li>Installs NuGet if not already present</li>
  <li>Uninstalls any previously installed versions of PowerCLI</li>
  <li>Adds the PowerShell Gallery as a trusted source</li>
  <li>Installs the PowerCLI module for all users</li>
  <li>Confirms the modules have been installed</li>
</ol>

<p>The prerequisite is you need WMF v5 or greater. The script will throw an error if you don’t have it installed.  Secondly this installs PowerCLI for all users on the computer. If you just want it on your profile change -AllUsers on line 33 to -CurrentUser</p>

<div class="language-posh highlighter-rouge"><pre class="highlight"><code><span class="c1">#WMF Version 5 or later required</span>
<span class="c1">#requires -Version 5</span>

<span class="c1">#Install NuGet if not already installed</span>
<span class="nv">$testNuGet</span> <span class="o">=</span> <span class="nv">$null</span>
<span class="nv">$nuGet</span> <span class="o">=</span> Get-PackageProvider | <span class="nb">Select-Object</span> -ExpandProperty Name
<span class="k">foreach</span><span class="o">(</span><span class="nv">$result</span> <span class="k">in</span> <span class="nv">$nuGet</span><span class="o">){</span>
    <span class="k">if</span><span class="o">(</span><span class="nv">$result</span> -eq <span class="s2">"NuGet"</span><span class="o">){</span>
        <span class="nv">$testNuGet</span> <span class="o">=</span> <span class="nv">$true</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="k">if</span><span class="o">(</span><span class="nv">$testNuGet</span> -eq <span class="nv">$true</span><span class="o">){</span>
    <span class="nb">Write-Host</span> <span class="s2">"NuGet is already installed"</span> -ForegroundColor Magenta
<span class="o">}</span>
<span class="k">else</span><span class="o">{</span>
    <span class="nb">Write-Host</span> <span class="s2">"NuGet is being installed"</span> -ForegroundColor Magenta
    Install-PackageProvider -Name NuGet -Force
<span class="o">}</span>

<span class="nb">Write-Host</span> <span class="s2">"Remove previous versions of PowerCLI"</span> -ForegroundColor Magenta
<span class="nv">$app</span> <span class="o">=</span> <span class="nb">Get-WmiObject</span> -Class Win32_Product -Filter <span class="s2">"Name like '%PowerCLI%'"</span>
<span class="nv">$app</span>.Uninstall<span class="o">()</span> | <span class="nb">Out-Null</span>

<span class="c1">#Remove any lingering directories from the old PowerCLI version</span>
<span class="k">If</span> <span class="o">(</span><span class="nb">Test-Path</span> <span class="s2">"C:</span><span class="se">\P</span><span class="s2">rogram Files (x86)</span><span class="se">\V</span><span class="s2">Mware</span><span class="se">\I</span><span class="s2">nfrastructure</span><span class="se">\"</span><span class="s2">){
 Remove-Item "</span>C:<span class="se">\P</span>rogram Files <span class="o">(</span>x86<span class="o">)</span><span class="se">\V</span>Mware<span class="se">\I</span>nfrastructure<span class="se">\"</span>
<span class="o">}</span>

<span class="nb">Write-Host</span> <span class="s2">"Adding the PowerShell Gallery as a Trusted Source"</span> -ForegroundColor Magenta
<span class="nb">Set</span>-PSRepository -Name PSGallery -InstallationPolicy Trusted

<span class="nb">Write-Host</span> <span class="s2">"Installing the PowerCLI Module"</span> -ForegroundColor Magenta
Install-Module -Name VMware.PowerCLI -Scope AllUsers -AllowClobber

<span class="nb">Write-Host</span> <span class="s2">"Show installed PowerCLI Modules"</span> -ForegroundColor Magenta
Get-Module -Name VMware<span class="k">*</span> -ListAvailable | <span class="nb">Format-Table</span> -Property Version,Name

</code></pre>
</div>

        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/categories/#powercli" class="page__taxonomy-item" rel="tag">PowerCLI</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/categories/#vmware" class="page__taxonomy-item" rel="tag">VMware</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-04-26T00:00:00+01:00">April 26, 2017</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="http://localhost:4000/vmware/vmug/Scotland-VMUG-April-2017/" class="pagination--pager" title="Scotland VMUG April 2017
">Previous</a>
    
    
      <a href="http://localhost:4000/career/Career-Options/" class="pagination--pager" title="Career Options
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/vmware/vCenter-Domain-Join-SMBv1/" rel="permalink">Disabled SMB1 and VCSA Domain Join Failure
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">STOP using SMB1 - but this breaks joining a vCenter Server Appliance to a domain. Fix it here
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/guag/Glasgow-Azure-User-Group-August-2017/" rel="permalink">Glasgow Azure Users Group August 2017
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Recap of the August 2017 Glasgow Azure Users Group Meeting
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/vmware/PowerCLI-6.5.2-Update/" rel="permalink">Update to PowerCLI 6.5.2
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">POwerCLI 6.5.2 has been released. Learn how to update from 6.5.1
</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/vmware/vExpert-2017/" rel="permalink">VMware vExpert 2017
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">I was awarded VMware vExpert 2017 Status!
</p>
  </article>
</div>
        
      </div>
    </div>
  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/cwestwater"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/cwestwater"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2017 Colin Westwater. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-102676397-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>






  </body>
</html>